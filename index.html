<meta charset="utf-8">

<!-- Load bootstrap: https://getbootstrap.com/docs/3.3/getting-started/ -->
<script src="https://d3js.org/d3.v5.min.js"></script>

<svg width="1000", height="600"></svg>

<div>
    <input type="checkbox" class="checkbox" name="ME" checked>
    <label for="ME">Men's Elite</label>
    <input type="checkbox" class="checkbox" name="WE" checked>
    <label for="WE">Women's Elite</label>
    <input type="checkbox" class="checkbox" name="Wave1" checked>
    <label for="Wave1">Wave 1</label>
    <input type="checkbox" class="checkbox" name="Wave2" checked>
    <label for="Wave2">Wave 2</label>
    <input type="checkbox" class="checkbox" name="Wave3" checked>
    <label for="Wave3">Wave 3</label>
    <input type="checkbox" class="checkbox" name="Wave4" checked>
    <label for="Wave4">Wave 4</label>
    <input type="checkbox" class="checkbox" name="Wave5" checked>
    <label for="Wave5">Wave 5</label>
    <input type="checkbox" class="checkbox" name="Wave6" checked>
    <label for="Wave6">Wave 6</label>
    <input type="checkbox" class="checkbox" name="Wave7" checked>
    <label for="Wave7">Wave 7</label>
    <input type="checkbox" class="checkbox" name="Wave8" checked>
    <label for="Wave8">Wave 8</label>
    <input type="checkbox" class="checkbox" name="Oldies" checked>
    <label for="Oldies">Oldies</label>
</div>

<body>
<script>
// Load Birkie Data:
d3.csv('d3_input.csv').then(function(birkie) { 
    birkie.forEach(function(d) {
    d.pace = +d.pace;
    d["distance"] = +d["distance"];
  });

console.log(birkie)

// Initialize SVG:
var svg = d3.select("svg"),
    width = +svg.attr("width"),
    height = +svg.attr("height")
    g = svg.append("g");

var margin = 50

// X & Y Axes:
var max_distance = d3.max(birkie, function(d) { return d.distance; } )
var min_distance = d3.min(birkie, function(d) { return d.distance; } )

var x_scale = d3.scaleLinear()
    .domain([0, max_distance]) // 0km to 50km Birkie Distance
    .range([margin, width-margin]);

var x_axis = d3.axisBottom()
    .scale(x_scale);

var xAxisTranslate = height - margin;

svg.append("g")
        .attr("transform", "translate(0," + xAxisTranslate +")")
        .call(x_axis);

var max_pace = d3.max(birkie, function(d) { return d.pace; } )
var min_pace = d3.min(birkie, function(d) { return d.pace; } )

var y_scale = d3.scaleLinear()
    .domain([min_pace, max_pace]) // -% to +% from Overall Avg Pace 
    .range([height-margin, margin]);

var y_axis = d3.axisLeft()
    .scale(y_scale);

var yAxisTranslate = margin;

svg.append("g")
    .attr("transform", "translate(" + yAxisTranslate + ", 0)")
    .call(y_axis);

// Add Data Points:

Waves = ["M Elite", "W Elite", "Wave 1", "Wave 2", "Wave 3", "Wave 4", "Wave 5", "Wave 6", "Wave 7", "Wave 8","Oldies"]; 

function filter_data(){
data = birkie // Original Data

// For each check box:
d3.selectAll(".checkbox").each(function(d,i){
  cb = d3.select(this);
  grp = cb.property("value")
  // If the box is check, I show the group
  if(cb.property("checked")){
    console.log(Waves[i])
  // Otherwise I hide it
  }else{
    data = data.filter(function(d){ return d.wave != Waves[i] })
  }
})
//console.log(data);
return data
}

function update() {

  data = filter_data();

  console.log(data);
  var t = d3.transition().duration(1000);

  // DATA JOIN
  // Join new data with old elements, if any.
  var points = g.selectAll("circle").data(birkie, function(d) { return d.Bib; }); // need unique id for each data point *   

  // Exit and remove old elements
  points.exit()
      .attr('class', "exit")
      .transition(t)
      .attr('cy', height)
      .style('fill-opacity', 1e-6)
      .remove();

  // UPDATE
  // Update old elements as needed.
  points
    .transition(t)
    .attr("class",'update')
    .attr("cx", function(d, i) { return x_scale(d.distance); })
    .attr('cy',function(d, i) { return y_scale(d.pace); });

  // ENTER new elements present in new data.
  points.enter()
        .append("circle")
        .transition(t)
        .attr("class","enter")
        .attr("r","2")
        .attr("cx", function(d, i) { return x_scale(d.distance); })
        .attr('cy',function(d, i) { return y_scale(d.pace); });
}

d3.selectAll(".checkbox").on("change",update);

update(); // Intialize 


});


</script>
</body>
