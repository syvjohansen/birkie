<meta charset="utf-8">

<!-- Load bootstrap: https://getbootstrap.com/docs/3.3/getting-started/ -->
<script src="https://d3js.org/d3.v5.min.js"></script>

<svg width="1000", height="600"></svg>

<!-- Button -->
<div>
    <input type="checkbox" class="checkbox" value="ME" checked><label>Men's Elite</label>
    <input type="checkbox" class="checkbox" value="WE" checked><label>Women's Elite</label>
    <input type="checkbox" class="checkbox" value="W1" checked><label>Wave 1</label>
    <input type="checkbox" class="checkbox" value="W2" checked><label>Wave 2</label>
    <input type="checkbox" class="checkbox" value="W3" checked><label>Wave 3</label>
    <input type="checkbox" class="checkbox" value="W4" checked><label>Wave 4</label>
    <input type="checkbox" class="checkbox" value="W5" checked><label>Wave 5</label>
    <input type="checkbox" class="checkbox" value="W6" checked><label>Wave 6</label>
    <input type="checkbox" class="checkbox" value="W7" checked><label>Wave 7</label>
    <input type="checkbox" class="checkbox" value="W8" checked><label>Wave 8</label>
    <input type="checkbox" class="checkbox" value="Oldies" checked><label>Oldies</label>
  </div>
<br>
<div> <input type="text" class="text" value="bib #"> </div>


<body>
<script>
// Load Birkie Data:
d3.csv('d3_input.csv').then(function(birkie) { 
    birkie.forEach(function(d) {
    d.pace = +d.pace;
    d["distance"] = +d["distance"];
  });

console.log(birkie)

// Initialize SVG:
var svg = d3.select("svg"),
    width = +svg.attr("width"),
    height = +svg.attr("height")
    points = svg.append("g");

var margin = 50

// X & Y Axes:
var max_distance = d3.max(birkie, function(d) { return d.distance; } )
var min_distance = d3.min(birkie, function(d) { return d.distance; } )

var x_scale = d3.scaleLinear()
    .domain([0, max_distance]) // 0km to 50km Birkie Distance
    .range([margin, width-margin]);

var x_axis = d3.axisBottom()
    .scale(x_scale);

var xAxisTranslate = height - margin;

svg.append("g")
    .attr("class", "x axis")
    .attr("transform", "translate(0," + xAxisTranslate +")")
    .call(x_axis);

var max_pace = d3.max(birkie, function(d) { return d.pace; } )
var min_pace = d3.min(birkie, function(d) { return d.pace; } )

var y_scale = d3.scaleLinear()
    .domain([min_pace, max_pace]) // -% to +% from Overall Avg Pace 
    .range([height-margin, margin]);

var y_axis = d3.axisLeft()
    .scale(y_scale);

var yAxisTranslate = margin;

svg.append("g")
    .attr("class", "y axis")
    .attr("transform", "translate(" + yAxisTranslate + ", 0)")
    .call(y_axis);

// Color Scale for Waves:
Waves = ["ME", "WE", "W1", "W2", "W3", "W4", "W5", "W6", "W7", "W8","Oldies"]; 
var colorScale = d3.scaleOrdinal()
    .domain(Waves)
    .range(d3.schemeTableau10); //console.log(d3.schemeTableau10)

// Intialize Points:
var t = d3.transition().duration(2000);

points
    .selectAll("circle")
    .data(birkie, function(d) { return d.wave; })
    .enter()
    .append("circle")
        //.transition(t)
        .attr("id", function(d) { return d.checkpoint + d.Bib; })
        .attr("class",function(d) { return d.wave; })
        .attr("cx", function(d) { return x_scale(d.distance); })
        .attr('cy',function(d) { return y_scale(d.pace); })
        .attr("r","2")
        .style("fill", function(d){ return colorScale(d.wave); });

// Wave Filter: 
//var birkie_copy = birkie;
//http://emilydolson.github.io/D3-visualising-data/09-d3exit.html
d3.selectAll(".checkbox").on("change",function() {
  var W = this.value;
  console.log(W)
  if (this.checked) { 
    var birkie_wave = birkie.filter(function(d){ return d.wave == W;});
    //birkie_copy = birkie_copy.concat(birkie_wave);

    points
        .selectAll("circle")
        .data(birkie_wave, function(d) { return d.wave; })
        .enter()
        .append("circle")
            //.transition(t)
            .attr("id", function(d) { return d.checkpoint + d.Bib; })
            .attr("class",function(d) { return d.wave; })
            .attr("cx", function(d) { return x_scale(d.distance); })
            .attr('cy',function(d) { return y_scale(d.pace); })
            .attr("r","2")
            .style("fill", function(d){ return colorScale(d.wave); });
  } else { 
    //birkie_copy = birkie_copy.filter(function(d){ return d.wave != W;});
    points
        .selectAll("."+W)
        .data(birkie)
        .remove();
    }
    //var element = d3.select('g').node();
    //console.log(element.getBoundingClientRect())//.width;

});
//var last_value = []
d3.selectAll(".text").on("change",function() {
    var B = this.value;

    for (let i = 1; i < 6; i++) {
        points
            .select("#S"+i.toString()+B)
            .data(birkie)
            .attr("r","10")
    }
    //var last_value = [B]
    
});






});


</script>
</body>
